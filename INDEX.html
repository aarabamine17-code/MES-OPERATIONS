<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>G√©n√©rateur de Documents Bancaires</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --primary-color: #3498db;
    --primary-dark: #2980b9;
    --secondary-color: #2c3e50;
    --secondary-light: #34495e;
    --accent-color: #9b59b6;
    --accent-light: #a66bbe;
    --success-color: #27ae60;
    --warning-color: #f39c12;
    --danger-color: #e74c3c;
    --light-color: #f8f9fa;
    --dark-color: #343a40;
    --gray-color: #6c757d;
    --light-gray: #e9ecef;
    --border-radius: 10px;
    --box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    --transition: all 0.3s ease;
  }

  * {
    box-sizing: border-box;
  }

  body {
    font-family: 'Montserrat', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    color: var(--secondary-color);
    line-height: 1.6;
  }

  .app-container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 20px;
  }

  .app {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    overflow: hidden;
    position: relative;
  }

  .app-header {
    background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 30px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .app-header::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
    background-size: cover;
  }

  .site-title {
    font-family: 'Playfair Display', serif;
    font-size: 42px;
    font-weight: 600;
    margin: 0 0 10px;
    text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    position: relative;
    z-index: 1;
  }

  .site-subtitle {
    font-size: 18px;
    font-weight: 300;
    opacity: 0.9;
    position: relative;
    z-index: 1;
  }

  .app-content {
    padding: 30px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
  }

  @media (max-width: 992px) {
    .app-content {
      grid-template-columns: 1fr;
    }
  }

  .controls-panel {
    background: var(--light-color);
    border-radius: var(--border-radius);
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  }

  .document-preview {
    background: white;
    border-radius: var(--border-radius);
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    min-height: 600px;
    display: flex;
    flex-direction: column;
  }

  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: var(--secondary-color);
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 10px;
  }

  .mode-selection {
    margin-bottom: 25px;
  }

  .mode-buttons {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }

  .mode-btn {
    flex: 1;
    padding: 15px;
    border: 2px solid var(--primary-color);
    background: white;
    color: var(--primary-color);
    border-radius: var(--border-radius);
    cursor: pointer;
    text-align: center;
    font-weight: 600;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .mode-btn i {
    font-size: 18px;
  }

  .mode-btn.active {
    background: var(--primary-color);
    color: white;
    box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
  }

  .mode-btn:hover:not(.active) {
    background: rgba(52, 152, 219, 0.1);
  }

  .upload-section {
    margin: 20px 0;
    padding: 20px;
    background: white;
    border-radius: var(--border-radius);
    border-left: 4px solid var(--accent-color);
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  .form-group {
    margin-bottom: 20px;
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--secondary-color);
  }

  select, input, textarea {
    width: 100%;
    padding: 12px 15px;
    font-size: 15px;
    border: 1px solid var(--light-gray);
    border-radius: var(--border-radius);
    transition: var(--transition);
    font-family: 'Montserrat', sans-serif;
  }

  select:focus, input:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
  }

  .checkbox-container {
    display: flex;
    align-items: center;
    margin: 15px 0;
  }

  .checkbox-container input {
    width: auto;
    margin-right: 10px;
  }

  .button-group {
    display: flex;
    gap: 15px;
    margin-top: 25px;
    flex-wrap: wrap;
  }

  button {
    padding: 14px 28px;
    font-size: 16px;
    cursor: pointer;
    border: none;
    border-radius: var(--border-radius);
    font-weight: 600;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  .btn-primary {
    background: var(--primary-color);
    color: white;
  }

  .btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(52, 152, 219, 0.3);
  }

  .btn-secondary {
    background: var(--secondary-color);
    color: white;
  }

  .btn-secondary:hover {
    background: var(--secondary-light);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(44, 62, 80, 0.3);
  }

  .btn-accent {
    background: var(--accent-color);
    color: white;
  }

  .btn-accent:hover {
    background: var(--accent-light);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(155, 89, 182, 0.3);
  }

  .btn-success {
    background: var(--success-color);
    color: white;
  }

  .btn-success:hover {
    background: #219653;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(39, 174, 96, 0.3);
  }

  .status-message {
    margin: 15px 0;
    padding: 15px;
    border-radius: var(--border-radius);
    font-weight: 500;
  }

  .success {
    background: rgba(39, 174, 96, 0.1);
    color: var(--success-color);
    border-left: 4px solid var(--success-color);
  }

  .error {
    background: rgba(231, 76, 60, 0.1);
    color: var(--danger-color);
    border-left: 4px solid var(--danger-color);
  }

  .info {
    background: rgba(52, 152, 219, 0.1);
    color: var(--primary-color);
    border-left: 4px solid var(--primary-color);
  }

  .excel-template {
    margin-top: 20px;
    padding: 20px;
    background: white;
    border-radius: var(--border-radius);
    border-left: 4px solid var(--primary-color);
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  .template-table {
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
    font-size: 14px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }

  .template-table th {
    background: var(--primary-color);
    color: white;
    padding: 12px;
    text-align: center;
    font-weight: 600;
  }

  .template-table td {
    border: 1px solid var(--light-gray);
    padding: 10px;
    background: white;
  }

  .template-example {
    background: rgba(52, 152, 219, 0.05) !important;
    font-style: italic;
    color: var(--secondary-color);
  }

  .document-type {
    margin-bottom: 20px;
  }

  .document-type select {
    width: 100%;
    font-size: 16px;
    font-weight: 600;
    padding: 12px 15px;
    background: white;
    border: 2px solid var(--light-gray);
  }

  .document-fields {
    display: none;
  }

  .virement-fields, .mise-fields, .releve-fields, .credit-fields, .debit-fields {
    margin-top: 20px;
  }

  .letter {
    font-family: 'Times New Roman', serif;
    font-size: 15px;
    line-height: 1.8;
    text-align: justify;
    white-space: pre-line;
    position: relative;
    z-index: 1;
    flex-grow: 1;
    padding: 20px;
    border: 1px solid var(--light-gray);
    border-radius: var(--border-radius);
    background: white;
  }

  .right {
    text-align: right;
    margin-bottom: 20px;
  }

  .left {
    text-align: left;
    margin: 15px 0;
    font-weight: bold;
  }

  .center {
    text-align: center;
    margin: 15px 0;
  }

  .signature {
    text-align: center;
    margin-top: 40px;
  }

  .letter-header {
    position: absolute;
    top: 10mm;
    left: 25mm;
    font-weight: bold;
    font-size: 20px;
    text-transform: uppercase;
    z-index: 2;
  }

  .letter-footer {
    position: absolute;
    bottom: 10mm;
    left: 25mm;
    right: 25mm;
    font-size: 12px;
    text-align: center;
    white-space: pre-line;
    line-height: 1.4;
    z-index: 2;
  }

  .developer-info {
    text-align: center;
    margin-top: 30px;
    padding: 20px;
    background: linear-gradient(135deg, var(--light-color) 0%, #e9ecef 100%);
    border-radius: var(--border-radius);
    border-top: 3px solid var(--primary-color);
  }

  .developer-name {
    font-weight: 700;
    color: var(--secondary-color);
    font-size: 18px;
  }

  .developer-contact {
    color: var(--gray-color);
    font-size: 16px;
    margin-top: 8px;
  }

  .download-link {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 600;
    border: 1px solid var(--primary-color);
    padding: 8px 15px;
    border-radius: var(--border-radius);
    transition: var(--transition);
    display: inline-block;
    margin-top: 10px;
  }

  .download-link:hover {
    background: var(--primary-color);
    color: white;
    text-decoration: none;
  }

  .main-controls {
    display: none;
  }

  .hidden {
    display: none;
  }

  @media print {
    .no-print {
      display: none !important;
    }
    
    body {
      background: white;
      padding: 0;
      margin: 0;
    }
    
    .app {
      box-shadow: none;
      padding: 25mm;
      margin: 0;
      width: 100%;
      height: 100%;
      position: relative;
    }
    
    .letter-header {
      position: fixed;
      top: 10mm;
      left: 25mm;
      right: 25mm;
      font-weight: bold;
      font-size: 20px;
      text-transform: uppercase;
    }
    
    .letter-footer {
      position: fixed;
      bottom: 10mm;
      left: 25mm;
      right: 25mm;
      font-size: 12px;
      text-align: center;
      white-space: pre-line;
      line-height: 1.4;
    }
    
    .letter {
      margin-top: 20mm;
      margin-bottom: 20mm;
    }
    
    .site-title, .developer-info {
      display: none;
    }
  }

  /* Icons */
  .icon {
    display: inline-block;
    width: 20px;
    height: 20px;
    background-size: contain;
    background-repeat: no-repeat;
  }

  .icon-excel {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="%233498db" d="M48 448V64c0-8.8 7.2-16 16-16h160v80c0 17.7 14.3 32 32 32h80v288c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16zm16-336c0-8.8 7.2-16 16-16h128v48H64v-32zm0 64v32h256v-32H64zm0 64v32h256v-32H64zm0 64v32h256v-32H64zm280 32H64v32h280v-32z"/></svg>');
  }

  .icon-manual {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="%233498db" d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-32s-14.33-32-32-32v-64c17.67 0 32-14.33 32-32zM128 224c35.35 0 64-28.65 64-64s-28.65-64-64-64-64 28.65-64 64 28.65 64 64 64zm96-96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32s-14.33-32-32-32h-96c-17.67 0-32 14.33-32 32zm160 192H224c-17.67 0-32 14.33-32 32s14.33 32 32 32h160c17.67 0 32-14.33 32-32s-14.33-32-32-32zm0 96H224c-17.67 0-32 14.33-32 32s14.33 32 32 32h160c17.67 0 32-14.33 32-32s-14.33-32-32-32z"/></svg>');
  }

  .icon-print {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="white" d="M448 192H64C28.65 192 0 220.7 0 256v96c0 17.67 14.33 32 32 32h32v96c0 17.67 14.33 32 32 32h320c17.67 0 32-14.33 32-32v-96h32c17.67 0 32-14.33 32-32V256C512 220.7 483.3 192 448 192zM384 448H128v-96h256V448zM432 248c13.25 0 24-10.75 24-24c0-13.26-10.75-24-24-24s-24 10.74-24 24C408 237.3 418.7 248 432 248zM128 64h229.5L384 90.51V160h64V77.25c0-8.484-3.375-16.62-9.375-22.62l-74.25-74.25C352.4 3.375 344.2 0 335.8 0H96C78.34 0 64 14.33 64 32v128h64V64z"/></svg>');
  }

  .icon-generate {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="white" d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480V396.4c0-4 1.5-7.8 4.2-10.7L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>');
  }

  .icon-upload {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="white" d="M144 480C64.47 480 0 415.5 0 336C0 273.2 40.17 219.8 96.2 200.1C96.07 197.4 96 194.7 96 192C96 103.6 167.6 32 256 32C315.3 32 367 64.25 394.7 112.2C409.9 101.1 428.3 96 448 96C501 96 544 138.1 544 192C544 204.2 541.7 215.8 537.6 226.6C596 238.4 640 290.1 640 352C640 422.7 582.7 480 512 480H144zM303 392.1C312.4 402.3 327.6 402.3 336.1 392.1L416.1 312.1C426.3 303.6 426.3 288.4 416.1 279C407.6 269.7 392.4 269.7 383 279L344 318.1V184C344 170.7 333.3 160 320 160C306.7 160 296 170.7 296 184V318.1L256.1 279C247.6 269.7 232.4 269.7 223 279C213.7 288.4 213.7 303.6 223 312.1L303 392.1z"/></svg>');
  }

  .icon-template {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="white" d="M448 96h-64V32c0-17.67-14.33-32-32-32H160C142.3 0 128 14.33 128 32v64H64C28.65 96 0 124.7 0 160v256c0 35.35 28.65 64 64 64h384c35.35 0 64-28.65 64-64V160C512 124.7 483.3 96 448 96zM320 48h64v48h-64V48zM160 48h64v48h-64V48zM64 416c-8.82 0-16-7.18-16-16V160c0-8.82 7.18-16 16-16h64v272H64zM464 400c0 8.82-7.18 16-16 16H192V144h256c8.82 0 16 7.18 16 16V400z"/></svg>');
  }
</style>
</head>
<body>
<div class="app-container">
  <div class="app">
    <div class="app-header no-print">
      <h1 class="site-title">MES OP√âRATIONS BANCAIRES</h1>
      <p class="site-subtitle">G√©n√©rateur de documents bancaires professionnels</p>
    </div>

    <div class="app-content">
      <div class="controls-panel">
        <div class="no-print">
          <h2 class="section-title">Configuration du document</h2>
          
          <!-- Section choix du mode -->
          <div class="mode-selection" id="modeSelection">
            <label><strong>Choisissez le mode de saisie :</strong></label>
            <div class="mode-buttons">
              <div class="mode-btn active" onclick="setGlobalMode('manuel')">
                <span class="icon icon-manual"></span>
                Saisie Manuelle
              </div>
              <div class="mode-btn" onclick="setGlobalMode('excel')">
                <span class="icon icon-excel"></span>
                Import Excel
              </div>
            </div>
          </div>

          <!-- Section Excel (visible uniquement en mode Excel) -->
          <div class="upload-section hidden" id="excelSection">
            <h3>Charger le fichier Excel de r√©f√©rence</h3>
            <div class="form-group">
              <input type="file" id="excelFile" class="file-input" accept=".xlsx, .xls">
            </div>
            <div class="button-group">
              <button onclick="loadExcelFile()" class="btn-success">
                <span class="icon icon-upload"></span>
                Charger les donn√©es
              </button>
              <button onclick="toggleExcelTemplate()" class="btn-accent">
                <span class="icon icon-template"></span>
                Voir le mod√®le
              </button>
            </div>
            <div id="uploadStatus" class="status-message"></div>
            
            <!-- Section cach√©e avec le mod√®le Excel -->
            <div id="excelTemplate" class="excel-template hidden">
              <h4>üìä Mod√®le de fichier Excel requis :</h4>
              <p><strong>Structure des colonnes :</strong></p>
              
              <table class="template-table">
                <thead>
                  <tr>
                    <th>Ordonneur</th>
                    <th>BANQUE</th>
                    <th>AGENCE</th>
                    <th>Compte</th>
                    <th>NOM</th>
                    <th>INFORMATION SOCIETE (PIED DE PAGE)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="template-example">ALPHA BMCE</td>
                    <td class="template-example">BANK OF AFRICA</td>
                    <td class="template-example">RABAT</td>
                    <td class="template-example">12345678901</td>
                    <td class="template-example">SOCIETE ALPHA</td>
                    <td class="template-example">SOCIETE ALPHA - Capital 100.000 DH - RC 12345</td>
                  </tr>
                  <tr>
                    <td>Nom du compte</td>
                    <td>Nom de la banque</td>
                    <td>Agence (optionnel)</td>
                    <td>Num√©ro de compte (RIB)</td>
                    <td>Nom</td>
                    <td>Pied de page (optionnel)</td>
                  </tr>
                </tbody>
              </table>
              
              <div style="margin-top: 15px;">
                <p><strong>üí° Conseils :</strong></p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                  <li>Les colonnes <strong>Ordonneur, BANQUE, Compte, NOM</strong> sont obligatoires</li>
                  <li>Utilisez le format : <code>NOM_SOCIETE - TYPE_COMPTE</code> pour l'ordonneur</li>
                  <li>Les fichiers <strong>.xlsx</strong> et <strong>.xls</strong> sont accept√©s</li>
                  <li>√âvitez les cellules vides dans les colonnes obligatoires</li>
                  <li>Pour t√©l√©charger le mod√®le, <a href="https://docs.google.com/spreadsheets/d/1aC21EGEdwdt-jo8QawhAmMrD_q64Rjk-/edit?usp=sharing&ouid=106645687971409921292&rtpof=true&sd=true" target="_blank" class="download-link">cliquez ici</a></li>
                </ul>
              </div>
              
              <button onclick="toggleExcelTemplate()" class="btn-secondary" style="margin-top: 10px;">Fermer</button>
            </div>
          </div>

          <!-- Contr√¥les principaux (visibles apr√®s choix du mode) -->
          <div class="main-controls hidden" id="mainControls">
            <div class="form-group document-type">
              <label>Type de document :</label>
              <select id="documentType">
                <option value="virement">Ordre de Virement</option>
                <option value="mise">Mise √† disposition</option>
                <option value="releve">Demande de Relev√© de Compte</option>
                <option value="credit">Demande avis de cr√©dit</option>
                <option value="debit">Demande avis de d√©bit</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>Ville :</label>
              <input type="text" id="ville" value="RABAT" placeholder="Saisir votre ville">
            </div>
            
            <div class="form-group">
              <label>Date :</label>
              <input type="date" id="date">
            </div>
            
            <div class="document-fields virement-fields">
              <div class="manuel-fields">
                <div class="form-group">
                  <label>Nom de l'√©metteur :</label>
                  <input type="text" id="emetteurManuel" placeholder="Nom de votre soci√©t√©">
                </div>
                <div class="form-group">
                  <label>Compte √©metteur :</label>
                  <input type="text" id="compteEmetteurManuel" placeholder="Num√©ro de compte">
                </div>
                <div class="form-group">
                  <label>Banque √©metteur :</label>
                  <input type="text" id="banqueEmetteurManuel" placeholder="Nom de la banque">
                </div>
                <div class="form-group">
                  <label>Nom du b√©n√©ficiaire :</label>
                  <input type="text" id="beneficiaireManuel" placeholder="Nom du b√©n√©ficiaire">
                </div>
                <div class="form-group">
                  <label>Compte b√©n√©ficiaire :</label>
                  <input type="text" id="compteBeneficiaireManuel" placeholder="Num√©ro de compte b√©n√©ficiaire">
                </div>
                <div class="form-group">
                  <label>Banque b√©n√©ficiaire :</label>
                  <input type="text" id="banqueBeneficiaireManuel" placeholder="Banque du b√©n√©ficiaire">
                </div>
              </div>
              
              <div class="excel-fields hidden">
                <div class="form-group">
                  <label>Ordonneur (Compte) :</label>
                  <select id="ordon"></select>
                </div>
                
                <div class="form-group">
                  <label>B√©n√©ficiaire (Compte) :</label>
                  <select id="benif"></select>
                </div>
              </div>
              
              <div class="form-group">
                <label>Montant en chiffres (Dhs) :</label>
                <input type="number" id="montantChiffre">
              </div>
              
              <div class="form-group">
                <label>Motif du virement (optionnel) :</label>
                <textarea id="motifVirement" placeholder="Raison du virement... (laisser vide pour ne pas afficher)"></textarea>
              </div>
              
              <div class="checkbox-container">
                <label><input type="checkbox" id="srbm"> SRBM (VIREMENT EXPRESS)</label>
              </div>
            </div>
            
            <div class="document-fields mise-fields hidden">
              <div class="manuel-mise-fields">
                <div class="form-group">
                  <label>Compte √† d√©biter :</label>
                  <input type="text" id="compteMiseManuel" placeholder="Num√©ro de compte">
                </div>
                <div class="form-group">
                  <label>Banque du compte :</label>
                  <input type="text" id="banqueMiseManuel" placeholder="Nom de la banque">
                </div>
                <div class="form-group">
                  <label>Agence (optionnel) :</label>
                  <input type="text" id="agenceMiseManuel" placeholder="Agence">
                </div>
              </div>
              
              <div class="excel-mise-fields hidden">
                <div class="form-group">
                  <label>Compte √† d√©biter :</label>
                  <select id="compteMise"></select>
                </div>
              </div>
              
              <div class="form-group">
                <label>Montant en chiffres (Dhs) :</label>
                <input type="number" id="montantMise">
              </div>
              
              <div class="form-group">
                <label>Nom du b√©n√©ficiaire :</label>
                <input type="text" id="nomBeneficiaire" placeholder="Ex: AMINE MOHAMED">
              </div>
              
              <div class="form-group">
                <label>Num√©ro de CIN :</label>
                <input type="text" id="cinBeneficiaire" placeholder="Ex: AD123456">
              </div>
            </div>
            
            <div class="document-fields releve-fields hidden">
              <div class="manuel-releve-fields">
                <div class="form-group">
                  <label>Compte demand√© :</label>
                  <input type="text" id="compteReleveManuel" placeholder="Num√©ro de compte">
                </div>
                <div class="form-group">
                  <label>Banque du compte :</label>
                  <input type="text" id="banqueReleveManuel" placeholder="Nom de la banque">
                </div>
                <div class="form-group">
                  <label>Agence (optionnel) :</label>
                  <input type="text" id="agenceReleveManuel" placeholder="Agence">
                </div>
              </div>
              
              <div class="excel-releve-fields hidden">
                <div class="form-group">
                  <label>Compte demand√© :</label>
                  <select id="compteReleve"></select>
                </div>
              </div>
              
              <div class="form-group">
                <label>P√©riode du relev√© :</label>
                <div class="month-year-container" style="display: flex; gap: 10px;">
                  <select id="moisReleve" style="flex: 1;">
                    <option value="01">Janvier</option>
                    <option value="02">F√©vrier</option>
                    <option value="03">Mars</option>
                    <option value="04">Avril</option>
                    <option value="05">Mai</option>
                    <option value="06">Juin</option>
                    <option value="07">Juillet</option>
                    <option value="08">Ao√ªt</option>
                    <option value="09">Septembre</option>
                    <option value="10">Octobre</option>
                    <option value="11">Novembre</option>
                    <option value="12">D√©cembre</option>
                  </select>
                  
                  <select id="anneeReleve" style="flex: 1;">
                    <!-- Les ann√©es seront g√©n√©r√©es dynamiquement -->
                  </select>
                </div>
              </div>
            </div>
            
            <div class="document-fields credit-fields hidden">
              <div class="manuel-credit-fields">
                <div class="form-group">
                  <label>Compte concern√© :</label>
                  <input type="text" id="compteCreditManuel" placeholder="Num√©ro de compte">
                </div>
                <div class="form-group">
                  <label>Banque du compte :</label>
                  <input type="text" id="banqueCreditManuel" placeholder="Nom de la banque">
                </div>
                <div class="form-group">
                  <label>Agence (optionnel) :</label>
                  <input type="text" id="agenceCreditManuel" placeholder="Agence">
                </div>
              </div>
              
              <div class="excel-credit-fields hidden">
                <div class="form-group">
                  <label>Compte concern√© :</label>
                  <select id="compteCredit"></select>
                </div>
              </div>
              
              <div class="form-group">
                <label>Date de l'op√©ration :</label>
                <input type="date" id="dateOperationCredit">
              </div>
              
              <div class="form-group">
                <label>Montant en chiffres (Dhs) :</label>
                <input type="number" id="montantCredit">
              </div>
              
              <div class="form-group">
                <label>Libell√© de l'op√©ration :</label>
                <textarea id="libelleCredit" placeholder="D√©crire l'op√©ration de cr√©dit..."></textarea>
              </div>
            </div>
            
            <div class="document-fields debit-fields hidden">
              <div class="manuel-debit-fields">
                <div class="form-group">
                  <label>Compte concern√© :</label>
                  <input type="text" id="compteDebitManuel" placeholder="Num√©ro de compte">
                </div>
                <div class="form-group">
                  <label>Banque du compte :</label>
                  <input type="text" id="banqueDebitManuel" placeholder="Nom de la banque">
                </div>
                <div class="form-group">
                  <label>Agence (optionnel) :</label>
                  <input type="text" id="agenceDebitManuel" placeholder="Agence">
                </div>
              </div>
              
              <div class="excel-debit-fields hidden">
                <div class="form-group">
                  <label>Compte concern√© :</label>
                  <select id="compteDebit"></select>
                </div>
              </div>
              
              <div class="form-group">
                <label>Date de l'op√©ration :</label>
                <input type="date" id="dateOperationDebit">
              </div>
              
              <div class="form-group">
                <label>Montant en chiffres (Dhs) :</label>
                <input type="number" id="montantDebit">
              </div>
              
              <div class="form-group">
                <label>Libell√© de l'op√©ration :</label>
                <textarea id="libelleDebit" placeholder="D√©crire l'op√©ration de d√©bit..."></textarea>
              </div>
            </div>
            
            <div class="checkbox-container">
              <label><input type="checkbox" id="headerCheckbox"> Ajouter l'en-t√™te et pied de page de soci√©t√©</label>
            </div>
            
            <div class="button-group">
              <button onclick="generateDocument()" class="btn-primary">
                <span class="icon icon-generate"></span>
                G√©n√©rer le document
              </button>
              <button onclick="window.print()" class="btn-secondary">
                <span class="icon icon-print"></span>
                Imprimer
              </button>
            </div>
            
            <!-- Informations du d√©veloppeur -->
            <div class="developer-info no-print">
              <div class="developer-name">D√©velopp√© par: AA.LENS</div>
              <div class="developer-contact">Contact: aarabamine17@gmail.com | INSTA: 2A.LENS</div>
            </div>
          </div>
        </div>
      </div>

      <div class="document-preview">
        <h2 class="section-title">Aper√ßu du document</h2>
        <div class="letter" id="documentOutput">
          <p style="text-align: center; color: #6c757d; margin-top: 50px;">
            Votre document g√©n√©r√© appara√Ætra ici
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Inclure SheetJS pour lire les fichiers Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script>
// Variables globales
let refData = [];
let ordonChoice, benifChoice, compteReleveChoice, compteMiseChoice, compteCreditChoice, compteDebitChoice;
let globalMode = 'manuel'; // 'manuel' ou 'excel'

// Fonction pour d√©finir le mode global
function setGlobalMode(mode) {
  globalMode = mode;
  
  // Mettre √† jour les boutons
  document.querySelectorAll('#modeSelection .mode-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  if (mode === 'excel') {
    // Afficher la section Excel et masquer les contr√¥les principaux
    document.getElementById('excelSection').classList.remove('hidden');
    document.getElementById('mainControls').classList.add('hidden');
  } else {
    // Masquer la section Excel et afficher les contr√¥les principaux
    document.getElementById('excelSection').classList.add('hidden');
    document.getElementById('mainControls').classList.remove('hidden');
    
    // Afficher les champs manuels et masquer les champs Excel
    document.querySelectorAll('.manuel-fields, .manuel-mise-fields, .manuel-releve-fields, .manuel-credit-fields, .manuel-debit-fields').forEach(field => {
      field.classList.remove('hidden');
    });
    document.querySelectorAll('.excel-fields, .excel-mise-fields, .excel-releve-fields, .excel-credit-fields, .excel-debit-fields').forEach(field => {
      field.classList.add('hidden');
    });
    
    // Afficher le type de document par d√©faut (virement)
    document.querySelectorAll(".document-fields").forEach(field => {
      field.classList.add('hidden');
    });
    document.querySelector(".virement-fields").classList.remove('hidden');
  }
}

// Fonction pour afficher/masquer le mod√®le Excel
function toggleExcelTemplate() {
  const template = document.getElementById('excelTemplate');
  template.classList.toggle('hidden');
}

// Initialisation des ann√©es pour le relev√©
function initAnnees() {
  const anneeSelect = document.getElementById('anneeReleve');
  const anneeActuelle = new Date().getFullYear();
  
  // Ajouter 5 ann√©es (2 avant, ann√©e actuelle, 2 apr√®s)
  for (let i = anneeActuelle - 2; i <= anneeActuelle + 2; i++) {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = i;
    if (i === anneeActuelle) option.selected = true;
    anneeSelect.appendChild(option);
  }
}

// G√©n√©ration des options HTML
function renderOptions(data, type = "ordon") {
  if (!data || data.length === 0) {
    return '<option value="">Aucune donn√©e charg√©e</option>';
  }
  
  return data.map(r =>
    `<option value="${r.compte}" data-banq="${r.banque}" data-agence="${r.agence || ''}" data-name="${type === "ordon" ? r.ordon : r.benif}" data-footer="${r.footer || ''}">
      ${type === "ordon" ? r.ordon : r.benif} ‚Äî ${r.compte} (${r.banque})
    </option>`
  ).join("");
}

// Initialiser les s√©lecteurs
function initSelects() {
  document.getElementById("ordon").innerHTML = renderOptions(refData, "ordon");
  document.getElementById("benif").innerHTML = renderOptions(refData, "benif");
  document.getElementById("compteReleve").innerHTML = renderOptions(refData, "ordon");
  document.getElementById("compteMise").innerHTML = renderOptions(refData, "ordon");
  document.getElementById("compteCredit").innerHTML = renderOptions(refData, "ordon");
  document.getElementById("compteDebit").innerHTML = renderOptions(refData, "ordon");
  
  // R√©initialiser Choices.js
  if (ordonChoice) ordonChoice.destroy();
  if (benifChoice) benifChoice.destroy();
  if (compteReleveChoice) compteReleveChoice.destroy();
  if (compteMiseChoice) compteMiseChoice.destroy();
  if (compteCreditChoice) compteCreditChoice.destroy();
  if (compteDebitChoice) compteDebitChoice.destroy();
  
  ordonChoice = new Choices("#ordon", { searchPlaceholderValue: "Rechercher un compte..." });
  benifChoice = new Choices("#benif", { searchPlaceholderValue: "Rechercher un compte..." });
  compteReleveChoice = new Choices("#compteReleve", { searchPlaceholderValue: "Rechercher un compte..." });
  compteMiseChoice = new Choices("#compteMise", { searchPlaceholderValue: "Rechercher un compte..." });
  compteCreditChoice = new Choices("#compteCredit", { searchPlaceholderValue: "Rechercher un compte..." });
  compteDebitChoice = new Choices("#compteDebit", { searchPlaceholderValue: "Rechercher un compte..." });
}

// Charger le fichier Excel
function loadExcelFile() {
  const fileInput = document.getElementById('excelFile');
  const statusDiv = document.getElementById('uploadStatus');
  
  if (!fileInput.files.length) {
    statusDiv.innerHTML = '<div class="error">Veuillez s√©lectionner un fichier Excel. <a href="javascript:void(0)" onclick="toggleExcelTemplate()" style="color: #721c24; text-decoration: underline;">Voir le mod√®le requis</a></div>';
    return;
  }
  
  const file = fileInput.files[0];
  const reader = new FileReader();
  
  reader.onload = function(e) {
    try {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      
      // Supposer que la premi√®re feuille contient les donn√©es
      const firstSheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[firstSheetName];
      
      // Convertir en JSON
      const jsonData = XLSX.utils.sheet_to_json(worksheet);
      
      // Transformer les donn√©es au format attendu
      refData = jsonData.map(row => {
        return {
          ordon: row.Ordonneur || '',
          banque: row.BANQUE || '',
          agence: row.AGENCE || '',
          compte: row.Compte || '',
          benif: row.NOM || '',
          footer: row.F || ''
        };
      });
      
      // Filtrer les entr√©es vides
      refData = refData.filter(item => item.ordon && item.compte);
      
      // Mettre √† jour les s√©lecteurs
      initSelects();
      
      statusDiv.innerHTML = `<div class="success">‚úÖ ${refData.length} comptes charg√©s avec succ√®s</div>`;
      
      // Masquer la section Excel et afficher les contr√¥les principaux
      document.getElementById('excelSection').classList.add('hidden');
      document.getElementById('mainControls').classList.remove('hidden');
      
      // Afficher les champs Excel et masquer les champs manuels
      document.querySelectorAll('.excel-fields, .excel-mise-fields, .excel-releve-fields, .excel-credit-fields, .excel-debit-fields').forEach(field => {
        field.classList.remove('hidden');
      });
      document.querySelectorAll('.manuel-fields, .manuel-mise-fields, .manuel-releve-fields, .manuel-credit-fields, .manuel-debit-fields').forEach(field => {
        field.classList.add('hidden');
      });
      
      // Afficher le type de document par d√©faut (virement)
      document.querySelectorAll(".document-fields").forEach(field => {
        field.classList.add('hidden');
      });
      document.querySelector(".virement-fields").classList.remove('hidden');
      
    } catch (error) {
      console.error('Erreur lors du chargement du fichier:', error);
      statusDiv.innerHTML = `<div class="error">‚ùå Erreur: ${error.message}. <a href="javascript:void(0)" onclick="toggleExcelTemplate()" style="color: #721c24; text-decoration: underline;">V√©rifier le mod√®le Excel</a></div>`;
    }
  };
  
  reader.onerror = function() {
    statusDiv.innerHTML = '<div class="error">‚ùå Erreur lors de la lecture du fichier. <a href="javascript:void(0)" onclick="toggleExcelTemplate()" style="color: #721c24; text-decoration: underline;">Voir le mod√®le requis</a></div>';
  };
  
  reader.readAsArrayBuffer(file);
}

// Gestion du changement de type de document
document.getElementById("documentType").addEventListener("change", function() {
  const type = this.value;
  
  // Masquer tous les champs
  document.querySelectorAll(".document-fields").forEach(field => {
    field.classList.add('hidden');
  });
  
  // Afficher les champs correspondants
  if (type === "virement") {
    document.querySelector(".virement-fields").classList.remove('hidden');
  } else if (type === "mise") {
    document.querySelector(".mise-fields").classList.remove('hidden');
  } else if (type === "releve") {
    document.querySelector(".releve-fields").classList.remove('hidden');
  } else if (type === "credit") {
    document.querySelector(".credit-fields").classList.remove('hidden');
  } else if (type === "debit") {
    document.querySelector(".debit-fields").classList.remove('hidden');
  }
});

// Conversion nombre ‚Üí lettres simplifi√©e
function numberToWords(n) {
  const unite = ["z√©ro","un","deux","trois","quatre","cinq","six","sept","huit","neuf","dix",
    "onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"];
  const dizaines = ["","","vingt","trente","quarante","cinquante","soixante","soixante-dix","quatre-vingt","quatre-vingt-dix"];

  if (n < 20) return unite[n];
  if (n < 100) {
    let d = Math.floor(n/10), r = n%10;
    if (d===7 || d===9) return dizaines[d] + (r>0 ? "-" + unite[10+r] : "");
    return dizaines[d] + (r>0 ? "-" + unite[r] : "");
  }
  if (n < 1000) {
    let c = Math.floor(n/100), r = n%100;
    return (c>1?unite[c]+" ":"") + "cent" + (r>0?" "+numberToWords(r):"");
  }
  if (n < 1000000) {
    let m = Math.floor(n/1000), r = n%1000;
    return (m>1?numberToWords(m)+" ":"") + "mille" + (r>0?" "+numberToWords(r):"");
  }
  return n.toString();
}

// Fonction pour formater une date au format fran√ßais (jj/mm/aaaa)
function formatDate(dateString) {
  if (!dateString) return '';
  const date = new Date(dateString);
  const day = date.getDate().toString().padStart(2, '0');
  const month = (date.getMonth() + 1).toString().padStart(2, '0');
  const year = date.getFullYear();
  return `${day}/${month}/${year}`;
}

// G√©n√©rer le document
function generateDocument() {
  const documentType = document.getElementById("documentType").value;
  const date = document.getElementById("date").value || "";
  const showHeader = document.getElementById("headerCheckbox").checked;

  if (documentType === "virement") {
    generateVirement();
  } else if (documentType === "mise") {
    generateMise();
  } else if (documentType === "releve") {
    generateReleve();
  } else if (documentType === "credit") {
    generateCredit();
  } else if (documentType === "debit") {
    generateDebit();
  }
}

// G√©n√©rer l'ordre de virement
function generateVirement() {
  const date = document.getElementById("date").value || "";
  const ville = document.getElementById("ville").value || "RABAT";
  const montantChiffre = parseInt(document.getElementById("montantChiffre").value) || 0;
  const montantLettre = montantChiffre > 0 ? numberToWords(montantChiffre) : "";
  const isSRBM = document.getElementById("srbm").checked;
  const showHeader = document.getElementById("headerCheckbox").checked;
  const motif = document.getElementById("motifVirement").value || "";

  let ordonName, ordonCompte, ordonBanq, benifName, benifCompte, benifBanq, footer;

  if (globalMode === 'manuel') {
    // Utiliser les valeurs manuelles
    ordonName = document.getElementById("emetteurManuel").value || "";
    ordonCompte = document.getElementById("compteEmetteurManuel").value || "";
    ordonBanq = document.getElementById("banqueEmetteurManuel").value || "";
    benifName = document.getElementById("beneficiaireManuel").value || "";
    benifCompte = document.getElementById("compteBeneficiaireManuel").value || "";
    benifBanq = document.getElementById("banqueBeneficiaireManuel").value || "";
    footer = ""; // Pas de footer en mode manuel
  } else {
    // Utiliser les valeurs Excel
    const ordonSel = document.getElementById("ordon").selectedOptions[0];
    const benifSel = document.getElementById("benif").selectedOptions[0];
    
    ordonBanq = ordonSel?.dataset.banq || "";
    const ordonAgence = ordonSel?.dataset.agence || "";
    ordonCompte = ordonSel?.value || "";
    ordonName = ordonSel?.dataset.name || "";
    benifName = benifSel?.dataset.name || "";
    benifBanq = benifSel?.dataset.banq || "";
    benifCompte = benifSel?.value || "";
    footer = ordonSel?.dataset.footer || "";

    // Construire l'adresse avec agence
    ordonBanq = ordonAgence ? `${ordonBanq} Agence ${ordonAgence}` : ordonBanq;
  }

  // Extraire le nom de la soci√©t√© √©mettrice (partie avant le tiret)
  const emetteurName = ordonName.split('-')[0] || ordonName;

  const template = `
${showHeader ? `<div class="letter-header">${emetteurName}</div>` : ''}

<div class="right"><b>${ville} le ${formatDate(date)}</b></div>

<div class="center">√Ä l'attention de Monsieur le Directeur<br><b>${ordonBanq}</b></div>

<div class="left">OBJET : Ordre de Virement${isSRBM ? ' (SRBM)' : ''}</div>

Monsieur,

Par le d√©bit de notre compte N¬∞ <b>${ordonCompte}</b>, veuillez virer la somme de <b>${montantChiffre} Dhs</b> (<b>${montantLettre}</b>) au profit de <b>${benifName}</b>, domicili√© √† <b>${benifBanq}</b> - Compte n¬∞ <b>${benifCompte}</b>.
${motif ? `\nMotif : <b>${motif}</b>` : ''}

<div class="signature"><b>Veuillez agr√©er, Monsieur le Directeur, l'expression de nos sentiments distingu√©s.</b></div>

${showHeader && footer ? `<div class="letter-footer">${footer}</div>` : ''}
`;

  document.getElementById("documentOutput").innerHTML = template;
}

function generateMise() {
  const date = document.getElementById("date").value || "";
  const ville = document.getElementById("ville").value || "RABAT";
  const montantChiffre = parseInt(document.getElementById("montantMise").value) || 0;
  const montantLettre = montantChiffre > 0 ? numberToWords(montantChiffre) : "";
  const nomBeneficiaire = document.getElementById("nomBeneficiaire").value || "";
  const cinBeneficiaire = document.getElementById("cinBeneficiaire").value || "";
  const showHeader = document.getElementById("headerCheckbox").checked;

  let compteBanq, compteAgence, compteNum, compteFooter, emetteurName;

  if (globalMode === 'manuel') {
    // Utiliser les valeurs manuelles
    compteNum = document.getElementById("compteMiseManuel").value || "";
    compteBanq = document.getElementById("banqueMiseManuel").value || "";
    compteAgence = document.getElementById("agenceMiseManuel").value || "";
    compteFooter = "";
    emetteurName = "";
  } else {
    // Utiliser les valeurs Excel
    const compteSel = document.getElementById("compteMise").selectedOptions[0];
    compteBanq = compteSel?.dataset.banq || "";
    compteAgence = compteSel?.dataset.agence || "";
    compteNum = compteSel?.value || "";
    const compteName = compteSel?.dataset.name || "";
    compteFooter = compteSel?.dataset.footer || "";
    emetteurName = compteName.split('-')[0];
  }

  const adresseCompte = compteAgence ? `${compteBanq} Agence ${compteAgence}` : compteBanq;

  const template = `
${showHeader && emetteurName ? `<div class="letter-header">${emetteurName}</div>` : ''}

<div class="right"><b>${ville} le ${formatDate(date)}</b></div>

<div class="center">√Ä l'attention de Monsieur le Directeur<br><b>${adresseCompte}</b></div>

<div class="left">OBJET : Mise √† disposition</div>

Monsieur,

Nous vous demandons de d√©biter notre compte N¬∞ <b>${compteNum}</b> de la somme de <b>${montantChiffre} Dhs</b> (<b>${montantLettre}</b>) en faveur de <b>${nomBeneficiaire}</b> titulaire de la CIN N¬∞ <b>${cinBeneficiaire}</b>.

<div class="signature"><b>Veuillez agr√©er, Monsieur le Directeur, l'expression de nos sentiments distingu√©s.</b></div>

${showHeader && compteFooter ? `<div class="letter-footer">${compteFooter || ''}</div>` : ''}
`;

  document.getElementById("documentOutput").innerHTML = template;
}

function generateReleve() {
  const date = document.getElementById("date").value || "";
  const ville = document.getElementById("ville").value || "RABAT";
  const mois = document.getElementById("moisReleve").value;
  const annee = document.getElementById("anneeReleve").value;
  const showHeader = document.getElementById("headerCheckbox").checked;

  let compteBanq, compteAgence, compteNum, compteFooter, emetteurName;

  if (globalMode === 'manuel') {
    // Utiliser les valeurs manuelles
    compteNum = document.getElementById("compteReleveManuel").value || "";
    compteBanq = document.getElementById("banqueReleveManuel").value || "";
    compteAgence = document.getElementById("agenceReleveManuel").value || "";
    compteFooter = "";
    emetteurName = "";
  } else {
    // Utiliser les valeurs Excel
    const compteSel = document.getElementById("compteReleve").selectedOptions[0];
    compteBanq = compteSel?.dataset.banq || "";
    compteAgence = compteSel?.dataset.agence || "";
    compteNum = compteSel?.value || "";
    const compteName = compteSel?.dataset.name || "";
    compteFooter = compteSel?.dataset.footer || "";
    emetteurName = compteName.split('-')[0];
  }

  const adresseCompte = compteAgence ? `${compteBanq} Agence ${compteAgence}` : compteBanq;

  const nomsMois = {
    "01": "janvier", "02": "f√©vrier", "03": "mars", "04": "avril", 
    "05": "mai", "06": "juin", "07": "juillet", "08": "ao√ªt", 
    "09": "septembre", "10": "octobre", "11": "novembre", "12": "d√©cembre"
  };

  const template = `
${showHeader && emetteurName ? `<div class="letter-header">${emetteurName}</div>` : ''}

<div class="right"><b>${ville} le ${formatDate(date)}</b></div>

<div class="center">√Ä l'attention de Monsieur le Directeur<br><b>${adresseCompte}</b></div>

<div class="left">OBJET : Demande de Relev√© de Compte</div>

Monsieur,

Nous vous prions de bien vouloir nous √©tablir le relev√© de notre compte N¬∞ <b>${compteNum}</b> pour le mois de <b>${nomsMois[mois]} ${annee}</b>.

<div class="signature"><b>Veuillez agr√©er, Monsieur le Directeur, l'expression de nos sentiments distingu√©s.</b></div>

${showHeader && compteFooter ? `<div class="letter-footer">${compteFooter || ''}</div>` : ''}
`;

  document.getElementById("documentOutput").innerHTML = template;
}

function generateCredit() {
  const date = document.getElementById("date").value || "";
  const ville = document.getElementById("ville").value || "RABAT";
  const dateOperation = document.getElementById("dateOperationCredit").value || "";
  const montantChiffre = parseInt(document.getElementById("montantCredit").value) || 0;
  const montantLettre = montantChiffre > 0 ? numberToWords(montantChiffre) : "";
  const libelle = document.getElementById("libelleCredit").value || "";
  const showHeader = document.getElementById("headerCheckbox").checked;

  let compteBanq, compteAgence, compteNum, compteFooter, emetteurName;

  if (globalMode === 'manuel') {
    // Utiliser les valeurs manuelles
    compteNum = document.getElementById("compteCreditManuel").value || "";
    compteBanq = document.getElementById("banqueCreditManuel").value || "";
    compteAgence = document.getElementById("agenceCreditManuel").value || "";
    compteFooter = "";
    emetteurName = "";
  } else {
    // Utiliser les valeurs Excel
    const compteSel = document.getElementById("compteCredit").selectedOptions[0];
    compteBanq = compteSel?.dataset.banq || "";
    compteAgence = compteSel?.dataset.agence || "";
    compteNum = compteSel?.value || "";
    const compteName = compteSel?.dataset.name || "";
    compteFooter = compteSel?.dataset.footer || "";
    emetteurName = compteName.split('-')[0];
  }

  const adresseCompte = compteAgence ? `${compteBanq} Agence ${compteAgence}` : compteBanq;

  const template = `
${showHeader && emetteurName ? `<div class="letter-header">${emetteurName}</div>` : ''}

<div class="right"><b>${ville} le ${formatDate(date)}</b></div>

<div class="center">√Ä l'attention de Monsieur le Directeur<br><b>${adresseCompte}</b></div>

<div class="left">OBJET : Demande d'avis de cr√©dit</div>

Monsieur,

Nous vous prions de bien vouloir nous cr√©diter notre compte N¬∞ <b>${compteNum}</b> de la somme de <b>${montantChiffre} Dhs</b> (<b>${montantLettre}</b>) pour la raison suivante : <b>${libelle}</b>.

<div class="signature"><b>Veuillez agr√©er, Monsieur le Directeur, l'expression de nos sentiments distingu√©s.</b></div>

${showHeader && compteFooter ? `<div class="letter-footer">${compteFooter || ''}</div>` : ''}
`;

  document.getElementById("documentOutput").innerHTML = template;
}

function generateDebit() {
  const date = document.getElementById("date").value || "";
  const ville = document.getElementById("ville").value || "RABAT";
  const dateOperation = document.getElementById("dateOperationDebit").value || "";
  const montantChiffre = parseInt(document.getElementById("montantDebit").value) || 0;
  const montantLettre = montantChiffre > 0 ? numberToWords(montantChiffre) : "";
  const libelle = document.getElementById("libelleDebit").value || "";
  const showHeader = document.getElementById("headerCheckbox").checked;

  let compteBanq, compteAgence, compteNum, compteFooter, emetteurName;

  if (globalMode === 'manuel') {
    // Utiliser les valeurs manuelles
    compteNum = document.getElementById("compteDebitManuel").value || "";
    compteBanq = document.getElementById("banqueDebitManuel").value || "";
    compteAgence = document.getElementById("agenceDebitManuel").value || "";
    compteFooter = "";
    emetteurName = "";
  } else {
    // Utiliser les valeurs Excel
    const compteSel = document.getElementById("compteDebit").selectedOptions[0];
    compteBanq = compteSel?.dataset.banq || "";
    compteAgence = compteSel?.dataset.agence || "";
    compteNum = compteSel?.value || "";
    const compteName = compteSel?.dataset.name || "";
    compteFooter = compteSel?.dataset.footer || "";
    emetteurName = compteName.split('-')[0];
  }

  const adresseCompte = compteAgence ? `${compteBanq} Agence ${compteAgence}` : compteBanq;

  const template = `
${showHeader && emetteurName ? `<div class="letter-header">${emetteurName}</div>` : ''}

<div class="right"><b>${ville} le ${formatDate(date)}</b></div>

<div class="center">√Ä l'attention de Monsieur le Directeur<br><b>${adresseCompte}</b></div>

<div class="left">OBJET : Demande d'avis de d√©bit</div>

Monsieur,

Nous vous prions de bien vouloir d√©biter notre compte N¬∞ <b>${compteNum}</b> de la somme de <b>${montantChiffre} Dhs</b> (<b>${montantLettre}</b>) pour la raison suivante : <b>${libelle}</b>.

<div class="signature"><b>Veuillez agr√©er, Monsieur le Directeur, l'expression de nos sentiments distingu√©s.</b></div>

${showHeader && compteFooter ? `<div class="letter-footer">${compteFooter || ''}</div>` : ''}
`;

  document.getElementById("documentOutput").innerHTML = template;
}

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
  initAnnees();
  
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('date').value = today;
  document.getElementById('dateOperationCredit').value = today;
  document.getElementById('dateOperationDebit').value = today;
  
  // Afficher le mode manuel par d√©faut
  setGlobalMode('manuel');
});
</script>
</body>
</html>
